#!/bin/bash

SESSIONPATH=/usr/lib/ws-session

source $SESSIONPATH/lib/rc.sh

source $SESSIONPATH/lib/wm.sh
source $SESSIONPATH/app/luakit.sh

SR_BOOKMARKS="$HOME/.config/surfraw/bookmarks"
SR_ELVIFILE="$HOME/.config/surfraw/elvilist"
SR_GO_TO_URL="g"
SR_DEFAULT_ELVI="google"
SR_MENU_TITLE="search the web:"
SR_BROWSER="s_luakit_start"

s_surfraw_menu() {
  if ! [ -f $SR_ELVIFILE ];then
    update_elvi
  fi
  search="$($MENU -p "$SR_MENU_TITLE" <$SR_ELVIFILE)"
  if ! [ "$search" ]; then
    return 1
  fi
  elvi=${search%% *}
  if [ "$SR_GO_TO_URL" = "$elvi" ]; then
    url="${search#* }"
  elif [ "$(grep -x -e "$elvi" "$SR_ELVIFILE")" ]; then
    url="$(sr -p $search)"
  else
    url="$(sr -p $SR_DEFAULT_ELVI $search)"
  fi
  if [ "$url" ] ; then
    $SR_BROWSER "$url" &
  fi
}

s_surfraw_menu 

# vim: ft=sh ts=2 et sw=2:

